# DISABLE in-process gRPC - use real Netty channels for proper flow control
quarkus.grpc.server.in-process.enabled=false
quarkus.grpc.clients.repo-service.in-process.enabled=false
quarkus.grpc.clients.connector-intake-service.in-process.enabled=false

# Use random port for test server
quarkus.http.test-port=0
# Use separate gRPC server (Netty-based) for testing - same as production
# Required for flow control window tuning (unified mode doesn't support it)
quarkus.grpc.server.use-separate-server=true
quarkus.grpc.server.port=0
# In test mode, Quarkus uses test-port instead of port (see GrpcServerRecorder.buildServer)
quarkus.grpc.server.test-port=0

# Configure repo-service client to connect to MockRepositoryService
# MockRepositoryService runs in same Quarkus instance on test server's gRPC port
# When use-separate-server=true, gRPC runs on quarkus.grpc.server.port (set to 0 for random)
%test.quarkus.grpc.clients.repo-service.host=localhost
# Port will be set dynamically by test via system property
%test.quarkus.grpc.clients.repo-service.port=0

# gRPC Performance Settings for Tests - Match production settings
quarkus.grpc.server.max-inbound-message-size=2147483647
quarkus.grpc.server.max-outbound-message-size=2147483647
quarkus.grpc.server.flow-control-window=104857600
quarkus.grpc.clients."*".max-inbound-message-size=2147483647
quarkus.grpc.clients."*".max-outbound-message-size=2147483647
quarkus.grpc.clients."*".flow-control-window=104857600
quarkus.grpc.clients.repo-service.max-inbound-message-size=2147483647
quarkus.grpc.clients.repo-service.max-outbound-message-size=2147483647
quarkus.grpc.clients.repo-service.flow-control-window=104857600

# dynamic-grpc library now uses quarkus.grpc.clients.* properties (see above)
# No need for separate pipeline.grpc.* properties

# Vert.x/Netty performance settings for tests
quarkus.vertx.event-loops-pool-size=8
quarkus.vertx.prefer-native-transport=true
quarkus.http.io-threads=8

# Enable DEBUG logging for performance analysis
quarkus.log.category."ai.pipeline.connector.intake".level=DEBUG
quarkus.log.category."io.grpc".level=DEBUG
quarkus.log.category."io.netty".level=WARN
quarkus.log.category."io.vertx".level=WARN
quarkus.log.category."io.quarkus.grpc".level=DEBUG

# Re-enable Dev Services to allow app to start (Hibernate requirement)
quarkus.datasource.devservices.enabled=true
quarkus.compose.devservices.enabled=true

