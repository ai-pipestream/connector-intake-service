# DISABLE in-process gRPC - use real Netty channels for proper flow control
quarkus.grpc.server.in-process.enabled=false
quarkus.grpc.clients.connector-intake-service.in-process.enabled=false

# Use random port for test HTTP server and a SEPARATE gRPC server (best performance)
quarkus.http.test-port=0
quarkus.grpc.server.use-separate-server=true
quarkus.grpc.server.test-port=0

# Configure test gRPC clients to connect to the Quarkus test gRPC port (separate gRPC server)
%test.quarkus.grpc.clients.connector-intake-service.host=localhost
%test.quarkus.grpc.clients.connector-intake-service.port=${quarkus.grpc.server.test-port}

# gRPC Performance Settings for Tests - Match production settings
quarkus.grpc.server.max-inbound-message-size=2147483647
quarkus.grpc.server.max-outbound-message-size=2147483647
quarkus.grpc.server.flow-control-window=104857600
quarkus.grpc.clients."*".max-inbound-message-size=2147483647
quarkus.grpc.clients."*".flow-control-window=104857600

# Vert.x/Netty performance settings for tests
quarkus.vertx.event-loops-pool-size=8
quarkus.vertx.prefer-native-transport=true
quarkus.http.io-threads=8

# Stork/HTTP fallback for repository in tests (MockRepositoryService runs in-process)
%test.connector-intake.repository-upload.base-url=http://localhost:${quarkus.http.test-port}/repository

# Re-enable Dev Services to allow app to start (Hibernate requirement)
quarkus.datasource.devservices.enabled=true
quarkus.compose.devservices.enabled=true
