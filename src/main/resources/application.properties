# Connector-Intake Service Configuration
quarkus.application.name=connector-intake-service
quarkus.application.version=1.0.0-SNAPSHOT

# ======================================================================================================================
# HTTP / gRPC Configuration
# ======================================================================================================================
# Connector-intake service port (38108)
quarkus.http.host=0.0.0.0
quarkus.http.port=38108
quarkus.grpc.server.use-separate-server=false
quarkus.grpc.server.enable-health-service=true
quarkus.grpc.server.enable-reflection-service=true
quarkus.grpc.server.max-inbound-message-size=2147483647

# gRPC Flow Control - 50MB window for large chunks
quarkus.grpc.server.flow-control-window=52428800

# Set gRPC client flow control for all clients (wildcard)
quarkus.grpc.clients."*".max-inbound-message-size=2147483647
quarkus.grpc.clients."*".flow-control-window=52428800

# Dev configuration
%dev.quarkus.http.port=38108
%dev.quarkus.http.root-path=/intake

# Test configuration
%test.quarkus.http.test-port=0

# ======================================================================================================================
# Database Configuration
# ======================================================================================================================
quarkus.datasource.db-kind=mysql
quarkus.datasource.username=pipeline
quarkus.datasource.password=password

# Dev mode - use MySQL dev service (port 3306) - separate database for connector-intake-service
%dev.quarkus.datasource.jdbc.url=jdbc:mysql://localhost:3306/pipeline_connector_intake_dev

# Hibernate configuration
%dev.quarkus.hibernate-orm.schema-management.strategy=none
%dev.quarkus.flyway.migrate-at-start=true

# Test: Clean database and let Hibernate create schema
%test.quarkus.hibernate-orm.schema-management.strategy=drop-and-create
%test.quarkus.hibernate-orm.sql-load-script=import.sql
%test.quarkus.flyway.migrate-at-start=false
%test.quarkus.flyway.clean-at-start=true

# Prod: Use migrations
%prod.quarkus.hibernate-orm.schema-management.strategy=validate
%prod.quarkus.flyway.migrate-at-start=true
%prod.quarkus.flyway.baseline-on-migrate=true

quarkus.hibernate-orm.sql-load-script=no-file

# ======================================================================================================================
# Dev Services Configuration
# ======================================================================================================================
# Compose Dev Services - Enable shared infrastructure for dev mode
%dev.quarkus.compose.devservices.enabled=true
%dev.quarkus.compose.devservices.files=${user.home}/.pipeline/compose-devservices.yml
%dev.quarkus.compose.devservices.project-name=pipeline-shared-devservices
%dev.quarkus.compose.devservices.start-services=true
%dev.quarkus.compose.devservices.stop-services=false
%dev.quarkus.compose.devservices.reuse-project-for-tests=true

# Dev Services - Disable standalone datasource devservices since we're using Compose Dev Services
%dev.quarkus.datasource.devservices.enabled=false

%dev.quarkus.devservices.timeout=120s

# Test profile - use compose dev services with MySQL
%test.quarkus.devservices.enabled=true
%test.quarkus.compose.devservices.files=../../src/test/resources/compose-test-services.yml
%test.quarkus.compose.devservices.start-services=true
%test.quarkus.compose.devservices.project-name=pipeline-test-services
%test.quarkus.compose.devservices.stop-services=false
%test.quarkus.compose.devservices.reuse-project-for-tests=true
%test.quarkus.compose.devservices.stop-timeout=30s

# Test datasource - MySQL from compose
%test.quarkus.datasource.username=pipeline
%test.quarkus.datasource.password=password
%test.quarkus.datasource.jdbc.url=jdbc:mysql://localhost:3307/pipeline_connector_intake_test

# ======================================================================================================================
# Service Registration Configuration
# ======================================================================================================================
service.registration.enabled=true
%test.service.registration.enabled=false
service.registration.service-name=connector-intake-service
service.registration.description=Connector document ingestion, authentication, metadata enrichment, and rate limiting
service.registration.service-type=APPLICATION
service.registration.host=${CONNECTOR_INTAKE_SERVICE_HOST:host.docker.internal}
service.registration.port=${quarkus.http.port}
service.registration.capabilities=document-ingestion,metadata-enrichment,rate-limiting
service.registration.tags=connector,intake,core-service,traefik.enable=true,traefik.http.routers.connector-intake-service.rule=PathPrefix(`/intake`),traefik.http.routers.connector-intake-service.entrypoints=web,traefik.http.middlewares.connector-intake-slash.redirectregex.regex=^/intake$$,traefik.http.middlewares.connector-intake-slash.redirectregex.replacement=/intake/,traefik.http.routers.connector-intake-service.middlewares=connector-intake-slash

# ======================================================================================================================
# Connector-Intake Configuration
# ======================================================================================================================
connector-intake.default-rate-limit-per-minute=1000
connector-intake.max-concurrent-streams=100
connector-intake.session-timeout-minutes=60
connector-intake.session-cleanup-interval-minutes=10
connector-intake.chunk-assembly-timeout-minutes=30
connector-intake.max-chunk-size-mb=10
connector-intake.max-document-size-mb=10240
connector-intake.max-filename-length=255

# ======================================================================================================================
# Container Image Configuration
# ======================================================================================================================
quarkus.container-image.registry=git.rokkon.com
quarkus.container-image.group=io-pipeline
quarkus.container-image.name=connector-intake-service
quarkus.container-image.tag=latest
quarkus.container-image.additional-tags=${quarkus.application.version}

